// ğŸŒŸ é¢˜ç›® 6: æ•°ç»„ä¸­åªæœ‰ä¸€ç§æ•°å‡ºç°æ¬¡æ•°å°äº m æ¬¡, å…¶ä»–æ•°éƒ½å‡ºç°äº† m æ¬¡
// ğŸ”— æµ‹è¯•é“¾æ¥: https://leetcode.cn/problems/single-number-ii/
// ğŸ§  æ ¸å¿ƒæ€æƒ³: 32ä½ä½ç»Ÿè®¡æ³• (Bit Counting) + æ¨¡è¿ç®—

#include <stdio.h>

/**
 * ğŸ› ï¸ é€šç”¨æŸ¥æ‰¾å‡½æ•°
 * @param arr æ•°ç»„æŒ‡é’ˆ
 * @param len æ•°ç»„é•¿åº¦
 * @param m   å…¶ä»–æ•°å‡ºç°çš„æ¬¡æ•° (ä¾‹å¦‚ 3)
 * @return    é‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„æ•°
 */
int find(int arr[], int len, int m)
{
    // ğŸ“¦ å‡†å¤‡ä¸€ä¸ªé•¿åº¦ä¸º 32 çš„æ•°ç»„, ç”¨æ¥è®°å½•æ‰€æœ‰æ•°å­—åœ¨æ¯ä¸€ä½ä¸Šçš„ 1 çš„æ€»æ•°
    // cnts[0] è®°å½•ç¬¬ 0 ä½(æœ€ä½ä½)æœ‰å¤šå°‘ä¸ª 1
    // cnts[31] è®°å½•ç¬¬ 31 ä½(æœ€é«˜ä½)æœ‰å¤šå°‘ä¸ª 1
    int cnts[32] = {0};
    int i = 0;
    int j = 0;

    // ğŸ”„ éå†æ¯ä¸€ä¸ªæ•°å­—
    for (i = 0; i < len; i++)
    {
        // ğŸ” éå†è¿™ä¸ªæ•°å­—çš„ 32 ä¸ªäºŒè¿›åˆ¶ä½
        for (j = 0; j < 32; j++)
        {
            // (arr[i] >> j) & 1 : å–å‡ºç¬¬ i ä¸ªæ•°åœ¨ç¬¬ j ä½ä¸Šçš„çŠ¶æ€ (0 æˆ– 1)
            cnts[j] += (arr[i] >> j) & 1;
        }
    }

    // ğŸ§© è¿˜åŸçœŸèº«
    // é€»è¾‘: å¦‚æœä¸€ä¸ªæ•°å‡ºç°äº† m æ¬¡, é‚£ä¹ˆå®ƒåœ¨ç¬¬ j ä½ä¸Šçš„ 1 çš„è´¡çŒ®ä¸€å®šæ˜¯ m çš„å€æ•°.
    //      cnts[j] % m != 0 è¯´æ˜é‚£ä¸ª"æ£ä¹±çš„æ•°"åœ¨ç¬¬ j ä½ä¸Šæœ‰ 1.
    int ans = 0;
    for (j = 0; j < 32; j++)
    {
        if (cnts[j] % m != 0)
        {
            // âš ï¸ å…³é”®ä¿®æ­£: (unsigned int)1
            // 1 é»˜è®¤æ˜¯ int (æœ‰ç¬¦å·), ç›´æ¥å·¦ç§» 31 ä½ä¼šè§¦ç¢°ç¬¦å·ä½å¯¼è‡´æº¢å‡ºæŠ¥é”™ (Runtime Error).
            // å¿…é¡»å¼ºè½¬ä¸ºæ— ç¬¦å·æ•°, å‘Šè¯‰ç¼–è¯‘å™¨"è¿™æ˜¯åˆæ³•çš„ä½æ“ä½œ".
            ans |= (unsigned int)1 << j;
        }
    }
    return ans;
}

/**
 * ğŸš€ LeetCode æ¥å£å‡½æ•°
 * é¢˜ç›®è®¾å®š m = 3
 */
int singleNumber(int *nums, int numsSize)
{
    return find(nums, numsSize, 3);
}

int main()
{
    // ğŸ§ª æµ‹è¯•ç”¨ä¾‹
    // 34 å‡ºç° 1 æ¬¡ (ç›®æ ‡)
    // 1, 2, 5, 6 å‡å‡ºç° 3 æ¬¡ (èƒŒæ™¯æ¿)
    int arr[] = {1, 2, 34, 5, 6, 6, 6, 5, 5, 2, 2, 1, 1};
    int len = sizeof(arr) / sizeof(arr[0]);

    // âœ… ç›´æ¥è°ƒç”¨å°è£…å¥½çš„å‡½æ•°, ä¸è¦åœ¨ main é‡Œé‡å†™é€»è¾‘ (DRYåŸåˆ™)
    int ans = singleNumber(arr, len);

    printf("The single number is: %d \n", ans); // é¢„æœŸè¾“å‡º 34

    return 0;
}
