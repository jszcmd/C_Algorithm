/*
 * =================================================================================
 * ğŸ“˜ ç¨‹åºåç§°:äºŒåˆ†æŸ¥æ‰¾å¯¹æ•°å™¨ - å¯»æ‰¾å·¦è¾¹ç•Œ (Binary Search Validator - Find Leftmost)
 * =================================================================================
 * ã€ä¸»è¦åŠŸèƒ½ã€‘
 * éªŒè¯ "åœ¨æœ‰åºæ•°ç»„ä¸­æŸ¥æ‰¾ >= num çš„æœ€å·¦ä½ç½®" ç®—æ³•çš„æ­£ç¡®æ€§.
 * é€šè¿‡å¤§é‡éšæœºæ ·æœ¬æµ‹è¯•,æ¯”å¯¹"äºŒåˆ†æŸ¥æ‰¾"ä¸"æš´åŠ›éå†"çš„ç»“æœ.
 *
 * ã€æ ¸å¿ƒé€»è¾‘ã€‘
 * 1. ç›®æ ‡ç®—æ³• (findLeft): äºŒåˆ†æŸ¥æ‰¾ >= num çš„ç¬¬ä¸€ä¸ªä½ç½®.
 * - ç­–ç•¥: é‡åˆ° >= num æ—¶,è®°å½•ç­”æ¡ˆå¹¶å‘å·¦ç¼©å‡èŒƒå›´,è¯•å›¾æ‰¾åˆ°æ›´é å·¦çš„ç­”æ¡ˆ.
 * 2. éªŒè¯ç®—æ³• (right): çº¿æ€§æ‰«æ,æ‰¾åˆ°ç¬¬ä¸€ä¸ª >= num çš„ä½ç½®ä½œä¸ºæ ‡å‡†ç­”æ¡ˆ.
 * 3. éšæœºæµ‹è¯• (test): ç”Ÿæˆéšæœºæ•°ç»„ -> æ’åº -> éšæœºæŸ¥æ‰¾ -> æ¯”å¯¹ç»“æœ.
 *
 * ã€ä½¿ç”¨æ–¹æ³•ã€‘
 * ç›´æ¥è¿è¡Œ.å¦‚æœæ§åˆ¶å°ä»…æ‰“å° "Test is begin" å’Œ "Test is finished",è¯´æ˜ç®—æ³•æ­£ç¡®.
 * =================================================================================
 */

#include <stdio.h>  // ä½¿ç”¨printf()
#include <stdlib.h> // ä½¿ç”¨rand(),srand(),qsort()
#include <time.h>   // ä½¿ç”¨time()

// [æ ¸å¿ƒç®—æ³•] äºŒåˆ†æŸ¥æ‰¾: æ‰¾ >= num çš„æœ€å·¦ä½ç½®
// æ—¶é—´å¤æ‚åº¦: O(logN)
int findLeft(const int arr[], const int len, const int num) {
    int l = 0, r = len - 1, m = 0;
    int ans = -1; // åˆå§‹åŒ–ä¸º-1,è‹¥æ²¡æ‰¾åˆ°åˆ™è¿”å›-1

    // ç»å…¸äºŒåˆ†é€»è¾‘: åœ¨ [l, r] åŒºé—´å†…æŸ¥æ‰¾
    while (l <= r) {
        m = l + (r - l) / 2; // å–ä¸­é—´ä½ç½® (é˜²æº¢å‡ºå†™æ³•)

        // [æ ¸å¿ƒç­–ç•¥]
        // å¦‚æœ arr[m] >= num, è¯´æ˜ m å¯èƒ½æ˜¯ç­”æ¡ˆ
        // ä½†æˆ‘ä»¬è¦æ‰¾"æœ€å·¦"çš„, æ‰€ä»¥è®°å½• m åç»§ç»­å¾€å·¦è¾¹æ‰¾
        if (arr[m] >= num) {
            ans = m; // è®°å½•å½“å‰å€™é€‰ç­”æ¡ˆ
            r = m - 1; // ç¼©å°èŒƒå›´, å¾€å·¦è¾¹äºŒåˆ†
        } else {
            l = m + 1; // arr[m] < num, ç­”æ¡ˆè‚¯å®šåœ¨å³è¾¹, ä¸è®°å½•
        }
    }
    return ans;
}

// [éªŒè¯ç®—æ³•] æš´åŠ›éå†
// æ—¶é—´å¤æ‚åº¦: O(N)
// ä½œç”¨: ç»å¯¹æ­£ç¡®çš„æ–¹æ³•, ç”¨ä½œ"æ ‡å‡†ç­”æ¡ˆ"
int right(const int arr[], const int len, const int num) {
    int i = 0;
    for (i = 0; i < len; i++) {
        if (arr[i] >= num) return i; // æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ç«‹å³è¿”å›
    }
    return -1; // æ²¡æ‰¾åˆ°
}

// è¾…åŠ©å·¥å…·: ç”Ÿæˆ [l, r] èŒƒå›´å†…çš„éšæœºæ•´æ•°
int randint(int l, int r) {
    static int initialized = 0; // é™æ€å˜é‡, å…¨å±€åªåˆå§‹åŒ–ä¸€æ¬¡
    if (!initialized) {
        srand(time(NULL)); // è®¾ç½®éšæœºç§å­
        initialized = 1; // æ ‡è®°å·²åˆå§‹åŒ–
    }
    return rand() % (r - l + 1) + l;
}

// qsortçš„æ¯”è¾ƒå‡½æ•° (å‡åº)
int int_cmp(const void *a, const void *b) {
    return (*(int *) a) - (*(int *) b);
}

// [æµ‹è¯•å•æ¬¡é€»è¾‘]
void test(int n, int v) {
    // 1. ç”Ÿæˆéšæœºæ•°ç»„
    int arr[n];
    int i = 0;
    for (i = 0; i < n; i++) {
        arr[i] = randint(0, v); // å¡«å…¥éšæœºæ•°
    }

    // 2. æ’åº (äºŒåˆ†æŸ¥æ‰¾çš„å‰ç½®æ¡ä»¶)
    qsort(arr, n, sizeof(int), int_cmp);

    // 3. ç”Ÿæˆä¸€ä¸ªéšæœºçš„ç›®æ ‡å€¼
    int num = randint(0, v);

    // 4. æ¯”å¯¹: å¦‚æœäºŒåˆ†ç»“æœ != æš´åŠ›ç»“æœ, è¯´æ˜å‡ºé”™äº†
    if (findLeft(arr, n, num) != right(arr, n, num)) {
        printf("Something went wrong\n");
        // è°ƒè¯•æ—¶å¯åœ¨æ­¤å¤„æ‰“å° arr, num, ä»¥åŠä¸¤ä¸ªå‡½æ•°çš„è¿”å›å€¼
    }
}

int main() {
    int N = 100; // æœ€å¤§æ•°ç»„é•¿åº¦
    int V = 1000; // æœ€å¤§æ•°å€¼èŒƒå›´
    int testTime = 500000; // æµ‹è¯•æ¬¡æ•° (æ ·æœ¬é‡)

    printf("Test is begin.\n");

    // å¼€å§‹æµ·é‡éšæœºæµ‹è¯•
    for (int i = 0; i < testTime; i++) {
        int n = randint(0, N); // éšæœºæ•°ç»„é•¿åº¦
        test(n, V); // æ‰§è¡Œæµ‹è¯•
    }

    printf("Test is finished.\n");
    return 0;
}
